function [A, E, R2] = fit_linear(Z, Y)

    n = size(Z,1);
    X = [ones(n,1) Z];

    A = (X' * X) \ (X' * Y);

    
    Y_hat = X * A;

    
    E = Y - Y_hat;

    
    SS_res = sum(E.^2);
    SS_tot = sum((Y - mean(Y)).^2);
    R2 = 1 - SS_res/SS_tot;
end
